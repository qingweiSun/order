(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{9480:function(e,t,s){Promise.resolve().then(s.bind(s,3536))},3536:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return D}});var a=s(9268),i=s(9804),r=s(7079),l=s(6006),n=s(5303),c=s(6684),d=s(8429),o=s(1728),h=s(4887),p=s(1009),x=s(8919),m=s(6394),j=s.n(m),f=s(5371),u=s(1970),y=s(4504),g=s(7618),S=s(2555),v=s(4828),w=s(7356),N=s(1461);let O=e=>{let{isDisabled:t,applyIng:s,apply:i}=e,{isOpen:r,onOpen:n,onOpenChange:d}=(0,f.q)(),[o,h]=l.useState("30");return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.A,{variant:"flat",color:"primary",isDisabled:t,isLoading:s,onClick:n,children:"续期"}),(0,a.jsx)(u.R,{isOpen:r,onOpenChange:()=>{d(),h("30")},children:(0,a.jsx)(g.A,{children:e=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(S.k,{className:"flex flex-col gap-1",children:"续期"}),(0,a.jsx)(v.I,{children:(0,a.jsxs)(y.X,{label:"请选择续期天数",value:o,onValueChange:h,children:[(0,a.jsx)(N.J,{value:"30",children:"30 天（一个月）"}),(0,a.jsx)(N.J,{value:"90",children:"90 天（一个季度）"}),(0,a.jsx)(N.J,{value:"180",children:"180 天（半年）"}),(0,a.jsx)(N.J,{value:"365",children:"365 天（一年）"}),(0,a.jsx)(N.J,{value:"7",children:"7 天（一周）"}),(0,a.jsx)(N.J,{value:"15",children:"15 天（半个月）"})]})}),(0,a.jsxs)(w.R,{children:[(0,a.jsx)(c.A,{color:"danger",variant:"flat",onPress:e,children:"取消"}),(0,a.jsx)(c.A,{color:"primary",onPress:()=>{e(),i(Number(o))},children:"确定"})]})]})})})]})},P=e=>{let{variant:t,color:s,isDisabled:i,isLoading:r,text:l,onConfirm:n,title:d,description:o}=e,{isOpen:h,onOpen:p,onOpenChange:x}=(0,f.q)();return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.A,{variant:t,color:s,isDisabled:i,isLoading:r,onClick:p,children:l}),(0,a.jsx)(u.R,{isOpen:h,onOpenChange:()=>{x()},children:(0,a.jsx)(g.A,{children:e=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(S.k,{className:"flex flex-col gap-1",children:d}),(0,a.jsx)(v.I,{children:o}),(0,a.jsxs)(w.R,{children:[(0,a.jsx)(c.A,{color:"danger",variant:"flat",onPress:e,children:"取消"}),(0,a.jsx)(c.A,{color:"primary",onPress:()=>{e(),n()},children:"确定"})]})]})})})]})},I=e=>{let{searchText:t,setSearchText:s}=e,[i,r]=(0,l.useState)([]),[m,f]=(0,l.useState)([]),[u,y]=(0,l.useState)(!1),[g,S]=(0,l.useState)(1);async function v(){y(!0);try{let e=await fetch("/api/mt/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shopName:t})}),s=await e.json();0==s.status?r(s.data.rows):x.ZP.error(""+s.status),y(!1)}catch(e){console.error(e),y(!1)}}let[w,N]=(0,l.useState)(!1);async function I(e,t){if(console.log(e),!e.mtShopAppItemOrder1.isSelected&&!e.mtShopAppItemOrder3.isSelected&&!e.mtShopAppItemOrder6.isSelected){x.ZP.error("请选择服务");return}if(N(!0),e.mtShopAppItemOrder1.isSelected)try{let s=await fetch("/api/mt/apply",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({wmPoiId:e.wmPoiId,itemId:1,orderDay:t})}),a=await s.json();if(0==a.status);else{x.ZP.error("自动出餐 + 防漏单申请失败"),N(!1);return}}catch(e){N(!1);return}if(e.mtShopAppItemOrder3.isSelected)try{let s=await fetch("/api/mt/apply",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({wmPoiId:e.wmPoiId,itemId:3,orderDay:t})}),a=await s.json();if(0==a.status);else{x.ZP.error("利润汇总+精准营销+评论回复申请失败"),N(!1);return}}catch(e){N(!1);return}if(e.mtShopAppItemOrder6.isSelected)try{let s=await fetch("/api/mt/apply",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({wmPoiId:e.wmPoiId,itemId:6,orderDay:t})}),a=await s.json();if(0==a.status);else{x.ZP.error("自动消息回复申请失败"),N(!1);return}}catch(e){N(!1);return}N(!1),await b()}async function b(){try{let e=await fetch("/api/mt/order",{method:"POST",headers:{"Content-Type":"application/json"}}),t=await e.json();0==t.status?(S(0),f(t.data.rows)):S(2)}catch(e){x.ZP.error(JSON.stringify(e)),console.error(e)}}async function C(e){try{e.loadingPass=!0,f([...m]);let t=await fetch("/api/mt/pass",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_str:"".concat(e.id)})}),s=await t.json();0==s.status?(x.ZP.success("审核成功"),await b()):(x.ZP.error("审核失败"),e.loadingPass=!1,f([...m]))}catch(t){x.ZP.error("审核失败"),console.log(t),e.loadingPass=!1,f([...m])}}async function D(e){try{e.loadingDelete=!0,f([...m]);let t=await fetch("/api/mt/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:"".concat(e.id)})}),s=await t.json();0==s.status?(x.ZP.success("已删除"),await b()):(x.ZP.error("删除失败"),e.loadingDelete=!1,f([...m]))}catch(t){x.ZP.error("删除失败"),console.log(t),e.loadingDelete=!1,f([...m])}}(0,l.useEffect)(()=>{b()},[]);let[T,Z]=(0,l.useState)(!1);async function J(){try{Z(!0),m.forEach(e=>{e.loadingPass=!0});let e=m.map(e=>e.id).join(";");f([...m]);let t=await fetch("/api/mt/pass",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_str:e})}),s=await t.json();0==s.status?(x.ZP.success("审核成功"),Z(!1),await b()):(x.ZP.error("审核失败"),Z(!1),m.forEach(e=>{e.loadingPass=!1}),f([...m]))}catch(e){x.ZP.error("审核失败"),console.error(e),Z(!1),m.forEach(e=>{e.loadingPass=!1}),f([...m])}}return(0,a.jsxs)("div",{className:"flex flex-col gap-4 justify-center",children:[(0,a.jsxs)("div",{children:["状态：",1==g&&(0,a.jsx)("span",{className:"text-yellow-500",children:"检测中..."}),0==g&&(0,a.jsx)("span",{className:"text-green-500",children:"在线"}),2==g&&(0,a.jsx)("span",{className:"text-red-500",children:"离线"})]}),(0,a.jsx)("div",{className:"text-2xl font-medium",children:"申请续期"}),(0,a.jsx)(h.w,{children:(0,a.jsx)(p.G,{children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(n.Y,{type:"text",placeholder:"请输入要搜索的店铺",variant:"bordered",color:"primary",value:t,onChange:e=>{s(e.target.value)}}),(0,a.jsx)(c.A,{color:"primary",isDisabled:0==t.length,onClick:v,isLoading:u,children:"搜索"})]})})}),0==i.length&&(0,a.jsx)("div",{className:"flex flex-col justify-center items-center",children:(0,a.jsx)(j(),{src:"./empty.svg",alt:"",width:220,height:300,className:"p-2"})}),i.map((e,t)=>(0,a.jsx)(h.w,{children:(0,a.jsxs)(p.G,{className:"flex flex-col gap-4",children:[(0,a.jsxs)("div",{className:"flex flex-row justify-center items-center",children:[(0,a.jsx)("div",{className:"text-medium font-medium flex-1",children:e.shopName}),(0,a.jsx)(O,{isDisabled:!e.mtShopAppItemOrder1.isSelected&&!e.mtShopAppItemOrder3.isSelected&&!e.mtShopAppItemOrder6.isSelected,applyIng:w,apply:async t=>{await I(e,t)}})]}),(0,a.jsx)(d.j,{}),(0,a.jsxs)("div",{className:"flex justify-between flex-col md:flex-row gap-1",children:[(0,a.jsx)(o.K,{isSelected:e.mtShopAppItemOrder1.isSelected,onValueChange:t=>{e.mtShopAppItemOrder1.isSelected=t,r([...i])},children:"自动出餐 + 防漏单"}),(0,a.jsxs)("div",{className:"text-gray-500 text-sm",children:["到期时间：",A(e.mtShopAppItemOrder1.serviceValidDate)]})]}),(0,a.jsxs)("div",{className:"flex justify-between flex-col md:flex-row gap-1",children:[(0,a.jsx)(o.K,{isSelected:e.mtShopAppItemOrder3.isSelected,onValueChange:t=>{e.mtShopAppItemOrder3.isSelected=t,r([...i])},children:"利润汇总+精准营销+评论回复"}),(0,a.jsxs)("div",{className:"text-gray-500 text-sm",children:["到期时间：",A(e.mtShopAppItemOrder3.serviceValidDate)]})]}),(0,a.jsxs)("div",{className:"flex justify-between flex-col md:flex-row gap-1",children:[(0,a.jsx)(o.K,{isSelected:e.mtShopAppItemOrder6.isSelected,onValueChange:t=>{e.mtShopAppItemOrder6.isSelected=t,r([...i])},children:"自动消息回复"}),(0,a.jsxs)("div",{className:"text-gray-500 text-sm",children:["到期时间：",A(e.mtShopAppItemOrder6.serviceValidDate)]})]})]})},t)),(0,a.jsxs)("div",{className:"flex flex-row items-center",children:[(0,a.jsx)("div",{className:"text-2xl font-medium flex-1",children:"审核列表"}),(0,a.jsx)(P,{color:"primary",variant:"shadow",isLoading:T,isDisabled:0===m.length,title:"注意",description:"确定要全部通过么？",text:"全部通过",onConfirm:J})]}),0==m.length&&(0,a.jsx)("div",{className:"flex flex-col justify-center items-center",children:(0,a.jsx)(j(),{src:"./empty.svg",alt:"",width:220,height:300,className:"p-2"})}),m.map((e,t)=>{var s,i;return(0,a.jsx)(h.w,{children:(0,a.jsxs)(p.G,{className:"flex flex-col gap-4",children:[(0,a.jsxs)("div",{className:"flex flex-row justify-center items-center",children:[(0,a.jsx)("div",{className:"text-medium font-medium flex-1",children:e.shopName}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(P,{variant:"flat",color:"primary",isDisabled:!1,isLoading:null!==(s=e.loadingPass)&&void 0!==s&&s,title:"注意",description:"确定要审核通过么？",text:"通过",onConfirm:async()=>{await C(e)}}),(0,a.jsx)(P,{variant:"flat",color:"danger",isDisabled:!1,isLoading:null!==(i=e.loadingDelete)&&void 0!==i&&i,title:"注意",description:"确定要删除么",text:"拒绝",onConfirm:async()=>{await D(e)}})]})]}),(0,a.jsx)(d.j,{}),(0,a.jsxs)("div",{children:[1==e.itemId&&(0,a.jsx)("div",{children:"续期类型：自动出餐 + 防漏单"}),3==e.itemId&&(0,a.jsx)("div",{children:"续期类型：利润汇总+精准营销+评论回复"}),6==e.itemId&&(0,a.jsx)("div",{children:"续期类型：自动消息回复"})]}),(0,a.jsxs)("div",{children:["续期天数：",e.orderDay," 天"]}),(0,a.jsxs)("div",{children:["消耗点数：",e.orderCost," 点"]}),(0,a.jsxs)("div",{children:["申请时间：",A(e.createAt)]})]})},t)})]})};function A(e){let t=new Date(e),s=t.getFullYear(),a=t.getMonth()+1,i=t.getDate(),r=t.getHours(),l=t.getMinutes(),n=t.getSeconds();return"".concat(s,"/").concat(a,"/").concat(i," ").concat(r,":").concat(l,":").concat(n)}let b=e=>{let{searchText:t,setSearchText:s}=e,[i,r]=(0,l.useState)([]),[m,f]=(0,l.useState)([]),[u,y]=(0,l.useState)(!1),[g,S]=(0,l.useState)(1);async function v(){y(!0);try{let e=await fetch("/api/eleme/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shopName:t})}),s=await e.json();r(s.data.rows),y(!1)}catch(e){console.error(e),y(!1)}}let[w,N]=(0,l.useState)(!1);async function I(e,t){if(console.log(e),!e.shopAppItemOrder1.isSelected&&!e.shopAppItemOrder3.isSelected){x.ZP.error("请选择服务");return}if(N(!0),e.shopAppItemOrder1.isSelected)try{let s=await fetch("/api/eleme/apply",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shopId:e.shopId,itemId:1,orderDay:t})}),a=await s.json();if(0==a.status);else{x.ZP.error("上报备餐申请失败"),N(!1);return}}catch(e){N(!1);return}if(e.shopAppItemOrder3.isSelected)try{let s=await fetch("/api/eleme/apply",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shopId:e.shopId,itemId:3,orderDay:t})}),a=await s.json();if(0==a.status);else{x.ZP.error("评论回复申请失败"),N(!1);return}}catch(e){N(!1);return}N(!1),await A()}async function A(){try{let e=await fetch("/api/eleme/order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shopName:t})}),s=await e.json();0==s.status?(S(0),f(s.data.rows)):S(2)}catch(e){x.ZP.error(JSON.stringify(e)),console.error(e)}}async function b(e){try{e.loadingPass=!0,f([...m]);let t=await fetch("/api/eleme/pass",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_str:"".concat(e.id)})}),s=await t.json();0==s.status?(x.ZP.success("审核成功"),await A()):(x.ZP.error("审核失败"),e.loadingPass=!1,f([...m]))}catch(t){x.ZP.error("审核失败"),console.log(t),e.loadingPass=!1,f([...m])}}async function D(e){try{e.loadingDelete=!0,f([...m]);let t=await fetch("/api/eleme/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:"".concat(e.id)})}),s=await t.json();0==s.status?(x.ZP.success("已删除"),await A()):(x.ZP.error("删除失败"),e.loadingDelete=!1,f([...m]))}catch(t){x.ZP.error("删除失败"),console.log(t),e.loadingDelete=!1,f([...m])}}(0,l.useEffect)(()=>{A()},[]);let[T,Z]=(0,l.useState)(!1);async function J(){try{Z(!0),m.forEach(e=>{e.loadingPass=!0});let e=m.map(e=>e.id).join(";");f([...m]);let t=await fetch("/api/eleme/pass",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_str:e})}),s=await t.json();0==s.status?(x.ZP.success("审核成功"),await A()):(x.ZP.error("审核失败"),Z(!1),m.forEach(e=>{e.loadingPass=!1}),f([...m]))}catch(e){x.ZP.error("审核失败"),console.error(e),Z(!1),m.forEach(e=>{e.loadingPass=!1}),f([...m])}}return(0,a.jsxs)("div",{className:"flex flex-col gap-4 justify-center",children:[(0,a.jsxs)("div",{children:["状态：",1==g&&(0,a.jsx)("span",{className:"text-yellow-500",children:"检测中..."}),0==g&&(0,a.jsx)("span",{className:"text-green-500",children:"在线"}),2==g&&(0,a.jsx)("span",{className:"text-red-500",children:"离线"})]}),(0,a.jsx)("div",{className:"text-2xl font-medium",children:"申请续期"}),(0,a.jsx)(h.w,{children:(0,a.jsx)(p.G,{children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(n.Y,{type:"text",placeholder:"请输入要搜索的店铺",variant:"bordered",color:"primary",value:t,onChange:e=>{s(e.target.value)}}),(0,a.jsx)(c.A,{color:"primary",isDisabled:0==t.length,onClick:v,isLoading:u,children:"搜索"})]})})}),0==i.length&&(0,a.jsx)("div",{className:"flex flex-col justify-center items-center",children:(0,a.jsx)(j(),{src:"./empty.svg",alt:"",width:220,height:300,className:"p-2"})}),i.map((e,t)=>(0,a.jsx)(h.w,{children:(0,a.jsxs)(p.G,{className:"flex flex-col gap-4",children:[(0,a.jsxs)("div",{className:"flex flex-row justify-center items-center",children:[(0,a.jsx)("div",{className:"text-medium font-medium flex-1",children:e.shopName}),(0,a.jsx)(O,{isDisabled:!e.shopAppItemOrder1.isSelected&&!e.shopAppItemOrder3.isSelected,applyIng:w,apply:async t=>{await I(e,t)}})]}),(0,a.jsx)(d.j,{}),(0,a.jsxs)("div",{className:"flex justify-between flex-col md:flex-row gap-1",children:[(0,a.jsx)(o.K,{isSelected:e.shopAppItemOrder1.isSelected,onValueChange:t=>{e.shopAppItemOrder1.isSelected=t,r([...i])},children:"上报备餐"}),(0,a.jsxs)("div",{className:"text-gray-500 text-sm",children:["到期时间：",C(e.shopAppItemOrder1.serviceValidDate)]})]}),(0,a.jsxs)("div",{className:"flex justify-between flex-col md:flex-row gap-1",children:[(0,a.jsx)(o.K,{isSelected:e.shopAppItemOrder3.isSelected,onValueChange:t=>{e.shopAppItemOrder3.isSelected=t,r([...i])},children:"评论回复"}),(0,a.jsxs)("div",{className:"text-gray-500 text-sm",children:["到期时间：",C(e.shopAppItemOrder3.serviceValidDate)]})]})]})},t)),(0,a.jsxs)("div",{className:"flex flex-row items-center",children:[(0,a.jsx)("div",{className:"text-2xl font-medium flex-1",children:"审核列表"}),(0,a.jsx)(P,{color:"primary",variant:"shadow",isLoading:T,isDisabled:0===m.length,title:"注意",description:"确定要全部通过么？",text:"全部通过",onConfirm:J})]}),0==m.length&&(0,a.jsx)("div",{className:"flex flex-col justify-center items-center",children:(0,a.jsx)(j(),{src:"./empty.svg",alt:"",width:220,height:300,className:"p-2"})}),m.map((e,t)=>{var s,i;return(0,a.jsx)(h.w,{children:(0,a.jsxs)(p.G,{className:"flex flex-col gap-4",children:[(0,a.jsxs)("div",{className:"flex flex-row justify-center items-center",children:[(0,a.jsx)("div",{className:"text-medium font-medium flex-1",children:e.shopName}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(P,{variant:"flat",color:"primary",isDisabled:!1,isLoading:null!==(s=e.loadingPass)&&void 0!==s&&s,title:"注意",description:"确定要审核通过么？",text:"通过",onConfirm:async()=>{await b(e)}}),(0,a.jsx)(P,{variant:"flat",color:"danger",isDisabled:!1,isLoading:null!==(i=e.loadingDelete)&&void 0!==i&&i,title:"注意",description:"确定要删除么",text:"拒绝",onConfirm:async()=>{await D(e)}})]})]}),(0,a.jsx)(d.j,{}),(0,a.jsxs)("div",{children:[1==e.itemId&&(0,a.jsx)("div",{children:"续期类型：上报备餐"}),3==e.itemId&&(0,a.jsx)("div",{children:"续期类型：评论回复"}),6==e.itemId&&(0,a.jsx)("div",{children:"续期类型：自动消息回复"})]}),(0,a.jsxs)("div",{children:["续期天数：",e.orderDay," 天"]}),(0,a.jsxs)("div",{children:["消耗点数：",e.orderCost," 点"]}),(0,a.jsxs)("div",{children:["申请时间：",C(e.createAt)]})]})},t)})]})};function C(e){let t=new Date(e),s=t.getFullYear(),a=t.getMonth()+1,i=t.getDate(),r=t.getHours(),l=t.getMinutes(),n=t.getSeconds();return"".concat(s,"/").concat(a,"/").concat(i," ").concat(r,":").concat(l,":").concat(n)}function D(){let[e,t]=(0,l.useState)("");return(0,a.jsxs)("div",{className:"w-screen flex justify-center h-screen",children:[(0,a.jsxs)("main",{className:"flex flex-col px-2 pt-4 w-full max-w-[580px] bg-white md:pt-8 overflow-y-scroll gap-4 md:px-4",children:[(0,a.jsxs)(i.n,{"aria-label":"Options",children:[(0,a.jsx)(r.r,{title:"美团外卖",children:(0,a.jsx)(I,{setSearchText:t,searchText:e})},"mt"),(0,a.jsx)(r.r,{title:"饿了么",children:(0,a.jsx)(b,{setSearchText:t,searchText:e})},"eleme")]}),(0,a.jsx)("div",{})]}),(0,a.jsx)(x.x7,{toastOptions:{style:{paddingRight:6,paddingLeft:16,borderRadius:10}}})]})}}},function(e){e.O(0,[83,253,698,744],function(){return e(e.s=9480)}),_N_E=e.O()}]);